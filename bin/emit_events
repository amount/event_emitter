#!/usr/bin/env ruby

$:.unshift File.expand_path('../../lib', __FILE__)
$stdout.sync = true

require 'avant/event_emitter/emitter'
require 'avant/event_emitter/multiplexer'

Avant::EventEmitter::Emitter.configure do |c|
  c.stathat_email   = ENV['AVANT_EVENT_EMITTER_STATHAT_ACCOUNT']
  c.librato_email   = ENV['AVANT_EVENT_EMITTER_LIBRATO_EMAIL']
  c.librato_api_key = ENV['AVANT_EVENT_EMITTER_LIBRATO_API_KEY']
  c.prefix          = ENV['AVANT_EVENT_EMITTER_PREFIX']

  c.drivers = [:stathat]
end
count = ENV['PROCESS_COUNT'].to_i
count = 2 if count < 1


count.times do
  Avant::EventEmitter::Multiplexer.subscribe
end

philotic.subscriber.endure